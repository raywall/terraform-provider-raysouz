name: CI/CD Pipeline
# on:
#   pull_request:
#     types: [closed]
#     branches: [main]

# permissions:
#   contents: write

# jobs:
#   validate:
#     if: github.event.pull_request.merged == true
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Set up Go
#         uses: actions/setup-go@v4
#         with:
#           go-version: "1.25.4"

#       - name: Run tests
#         run: go test ./... -v -race

#       - name: Build provider
#         run: go build -o terraform-provider-raysouz .

#   release-go:
#     if: github.event.pull_request.merged == true
#     runs-on: ubuntu-latest
#     needs: validate

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4
#         with:
#           fetch-depth: 0
#           fetch-tags: true

#       - name: Set up Go
#         uses: actions/setup-go@v4
#         with:
#           go-version: "1.25.4"

#       - name: Configure Git
#         run: |
#           git config --global user.name "GitHub Actions"
#           git config --global user.email "actions@github.com"

#       - name: Get and increment version
#         id: version
#         run: |
#           latest_tag=$(git describe --tags --abbrev=0 --match="v*" 2>/dev/null || echo "v0.0.0")
#           echo "Latest tag: $latest_tag"

#           version="${latest_tag#v}"
#           IFS='.' read -r major minor patch <<< "$version"

#           if [ "$major" -eq "0" ]; then
#             new_tag="v1.0.0"
#           else
#             next_patch=$((patch + 1))
#             new_tag="v${major}.${minor}.${next_patch}"
#           fi

#           echo "New tag: $new_tag"
#           echo "new_tag=$new_tag" >> $GITHUB_OUTPUT

#           git tag "$new_tag"
#           git push origin "$new_tag"
#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

#       - name: Run GoReleaser (for Go Proxy)
#         uses: goreleaser/goreleaser-action@v5
#         with:
#           version: latest
#           args: release --clean
#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

#       - name: Publish to Go Proxy
#         run: |
#           echo "ðŸ“¦ Publishing ${{ steps.version.outputs.new_tag }} to Go Proxy..."
#           curl -s "https://proxy.golang.org/github.com/${{ github.repository }}/@v/${{ steps.version.outputs.new_tag }}.info"
#           echo ""
#           echo "âœ… Published to Go Proxy!"
